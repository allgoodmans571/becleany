<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../stylesheets/main.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/masc-for-croc.ico" type="image/x-icon">
    <title>Document</title>
</head>
<body>
    <header>
        <img class="logo_text" src="../images/logo.png" alt="">
        <div class="logo logo_div" >
            <img class="logo_img" src="../images/masc for croc.svg" alt="">
        </div>
    </header>

    <main>
        <div class="title_box">
            <p id="user_name" class="title">Привет {UserName}!</p>
        </div>

        <div class="task">
            <p class="task_title"  >На этой неделе ты: </p>
            <p class="task_q" id="task1" ></p>
            <p class="task_q" id="task2" ></p>
            <p class="task_q" id="task3" ></p>
            <p class="task_q" id="task4" ></p>
            <p class="task_q" id="task5" ></p>
            <p class="task_q" id="task6" ></p>
        </div>
        <div class="content">
            <button class="auth_btn">
                <p onclick='exit()' class="text_btn">Выйти!</p>
            </button>
        </div>
    </main>
    <script>

        function exit() {
            fetch('http://213.189.216.91:3000/exit', {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "POST",
        })
            .then(response => response.text())
            .then((response) => {
                console.log(response)
                location.replace("http://213.189.216.91:3000/");
            })
            .catch(err => console.log(err))
        }

        fetch('http://213.189.216.91:3000/task_get', {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "POST",
        })
            .then(response => response.text())
            .then((response) => {
                response = JSON.parse(response)
                console.log(response);

                document.querySelector('#user_name').innerText = `Привет ${response.data.login.split('@')[0]}!`
                for (let i = 1; i <= 6; i++) {

                    document.querySelector(`#task${i}`).innerText = response.data[`task${i}`] != '' ? '✔ ' +response.data[`task${i}`] : response.tasks[`${i -1}`][`name`]     

                    if (response.data[`task${i}`] != '') {
                        document.querySelector(`#task${i}`).classList.add('true')   
                    }
                }


            })
            .catch(err => console.log(err))
    </script>
    
    
</body>
</html>